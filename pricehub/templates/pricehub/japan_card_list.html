{% extends 'pricehub/base.html' %}

{% block title %}{{ expansion.name }} - ì¹´ë“œ ëª©ë¡{% endblock %}

{% block content %}
<h2>ğŸ—¾ {{ expansion.name }}</h2>
<p class="text-muted">{{ expansion.code }}</p>

<!-- ê²€ìƒ‰ ë° í•„í„° -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <input type="text" name="q" class="form-control" placeholder="ì¹´ë“œëª… ë˜ëŠ” ë²ˆí˜¸" value="{{ query }}">
            </div>
            <div class="col-md-2">
                <select name="rarity" class="form-select">
                    <option value="">ì „ì²´ ë ˆì–´ë„</option>
                    {% for rarity in rarities %}
                    <option value="{{ rarity }}" {% if rarity_filter == rarity %}selected{% endif %}>{{ rarity }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="mirror" class="form-select">
                    <option value="">ì „ì²´</option>
                    <option value="normal" {% if mirror_filter == 'normal' %}selected{% endif %}>ì¼ë°˜</option>
                    <option value="mirror" {% if mirror_filter == 'mirror' %}selected{% endif %}>ë¯¸ëŸ¬</option>
                </select>
            </div>
            <div class="col-md-2">
                <select name="sort" class="form-select">
                    <option value="card_number" {% if sort_by == 'card_number' %}selected{% endif %}>ì¹´ë“œë²ˆí˜¸ìˆœ</option>
                    <option value="name" {% if sort_by == 'name' %}selected{% endif %}>ì¹´ë“œëª…ìˆœ</option>
                    <option value="rarity" {% if sort_by == 'rarity' %}selected{% endif %}>ë ˆì–´ë„ìˆœ</option>
                    <option value="price" {% if sort_by == 'price' %}selected{% endif %}>ê°€ê²©ìˆœ</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">ê²€ìƒ‰</button>
            </div>
        </form>
    </div>
</div>

<!-- ì¹´ë“œ ëª©ë¡ í…Œì´ë¸” -->
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>ì´ë¯¸ì§€</th>
                <th>ì¹´ë“œë²ˆí˜¸</th>
                <th>ì¹´ë“œëª…</th>
                <th>ë ˆì–´ë„</th>
                <th>ë¯¸ëŸ¬</th>
                <th>ìµœì‹ ê°€ê²©</th>
                <th>ìƒì„¸</th>
            </tr>
        </thead>
        <tbody>
            {% for card in cards %}
            <tr>
                <td>
                    {% if card.image_url %}
                    <img src="{{ card.image_url }}" alt="{{ card.name }}" style="width: 60px; height: auto;">
                    {% else %}
                    <div class="bg-secondary text-white text-center" style="width: 60px; height: 80px; line-height: 80px;">
                        <small>No Image</small>
                    </div>
                    {% endif %}
                </td>
                <td>{{ card.card_number }}</td>
                <td>
                    {{ card.name }}
                    {% if card.mirror_type %}
                    <br><small class="text-muted">{{ card.mirror_type }}</small>
                    {% endif %}
                </td>
                <td><span class="badge bg-secondary">{{ card.rarity }}</span></td>
                <td>
                    {% if card.is_mirror %}
                    <span class="badge bg-info">ë¯¸ëŸ¬</span>
                    {% endif %}
                </td>
                <td>
                    {% if card.latest_price %}
                    Â¥{{ card.latest_price|floatformat:0 }}
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'pricehub:japan_card_detail' card.id %}" class="btn btn-sm btn-primary">ìƒì„¸</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p class="text-muted">ì´ {{ cards.count }}ì¥</p>
{% endblock %}